---
title: "GLM of SEV scores"
author: "Jenn_McHenry"
date: "December 1, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

# Initial examination of x and y parameters
```{r cars}
dat=read.csv("vulnerability_covariates.csv")

head(dat)

summary(dat)
```

```{r visualizing data distribution}

head(dat)
names(dat)

boxplot(dat[c(3:8)])

#Normality test
?shapiro.test
shapiro.test(dat$eco_sens) #normal
shapiro.test(dat$eco_recov) #normal 
shapiro.test(dat$eco_vul) #normal
shapiro.test(dat$soc_sen) #normal
shapiro.test(dat$soc_ac) #non-normal if using 0.05, normal if using 0.01
shapiro.test(dat$se_vul) #non-normal if using 0.05, normal if using 0.01

```

## Ecological Sensitivity

```{r Ecologial Sensitivity, echo=TRUE}
library(dplyr)
library(MASS)
library(car)
library(modEvA)


head(dat_tf)
dat_select<-dat %>%
  na.omit()%>%
  dplyr::select(eco_sens,eez_percent_prot,coral_percent_prot,fish_reg_total,wgi_score)

summary(dat$eco_exp)

#############################################################################
##Gaussian error structure
null=glm(eco_sens~1,data=dat_select,family=gaussian(link="identity"))
gaussian=glm(eco_sens ~ .,data=dat_select,family=gaussian(link="identity"))# Model with all Xs included
gaussian$deviance # this is the explained deviance
RsqGLM(gaussian) #This is an approximation for an Rsqard
vif(gaussian) # values for each variable closer to one indicate no multicolinaerity.  Higher values closer to 10 indicate the variable may be correlated with another explanatory variable.
plot(gaussian) #all Xs included
summary(gaussian) #all Xs included

#Comparing new model to the null
anova(null,gaussian,test = "Chisq")  # an increase in deviance means a, a non-significant pvalue is a non-significant model

#model adequacy (values above 0.05 make an adequate model)
pchisq(0.057259,gaussian$df.residual,lower.tail = FALSE)

#stepwise backward removal and addition of variables
drop1(gaussian)

#lowest AIC model that isn't the null model
LowestAIC=glm(eco_sens~coral_percent_prot+fish_reg_total+wgi_score,data=dat_select,family=gaussian(link="identity"))
LowestAIC$deviance # this is the explained deviance
RsqGLM(LowestAIC) #This is an approximation for an Rsqard
plot(LowestAIC) #plots for lowest AIC model
summary(LowestAIC) #summary of lowest AIC model
drop1(LowestAIC) # just a check to make sure you shouldn't remove any more

#Comparing new models to the null
anova(null,gaussian,LowestAIC,test = "Chisq")  # an increase in deviance means a, a non-significant pvalue is a non-significant model

#model adequacy (values above 0.05 make an adequate model)
pchisq(LowestAIC$deviance,LowestAIC$df.residual,lower.tail = FALSE)

##########################3
#Quasibinomial Errors

QB=glm(eco_sens ~ .,data=dat_select,family=quasibinomial)# Model with all Xs included

QB$deviance # this is the explained deviance
RsqGLM(QB) #This is an approximation for an Rsqard
plot(QB) #all Xs included
summary(QB) #all Xs 

anova(null,gaussian,LowestAIC,QB,test = "Chisq")  # an increase in deviance means a non-significant model, a high pvalue is a non-significant model

#model adequacy (values above 0.05 make an adequate model)
pchisq(0.37664,QB$df.residual,lower.tail = FALSE)

#stepwise backward removal and addition of variables of full QB model
drop1(QB)

#lowest AIC model that isn't the null model
QB_best=glm(eco_sens~ coral_percent_prot+wgi_score+fish_reg_total,data=dat_select,family=quasibinomial)
QB_best$deviance # this is the explained deviance
RsqGLM(QB_best) #This is an approximation for an Rsqard

cr.plots(QB_best) #all Xs included
summary(QB_best) #all Xs included

anova(null,gaussian,LowestAIC,QB,QB_best,test = "Chisq") # an increase in deviance means a non-significant model, a high pvalue is a non-significant model

#model adequacy (values above 0.05 make an adequate model)
pchisq(QB_best$deviance,QB_best$df.residual,lower.tail = FALSE)


```


## Ecological Recovery

```{r Ecologial Recovery, echo=TRUE}
library(dplyr)
library(MASS)
library(car)
library(modEvA)

head(dat)
dat_select<-dat %>%
  na.omit()%>%
  dplyr::select(eco_recov,eez_percent_prot,coral_percent_prot,fish_reg_total,wgi_score)

results=glm(eco_recov ~ .,data=dat_select)# Model with all Xs included
Dsquared(results)  # explained deviance with all Xs included
plot(results) #all Xs included
summary(results) #all Xs included

#stepwise backward removal and addition of variables
stepAIC(results,direction = "both")

#lowest AIC model that isn't the null model
LowestAIC=glm(eco_recov~wgi_score,data=dat_select)
Dsquared(LowestAIC)  # explained deviance with all Xs included
plot(LowestAIC) #all Xs included
summary(LowestAIC) #all Xs included

```


## Ecological Vulnerability

```{r Ecologial Vulnerability, echo=TRUE}
library(dplyr)
library(MASS)
library(car)
library(modEvA)

head(dat)
dat_select<-dat %>%
  na.omit()%>%
  dplyr::select(eco_vul,eez_percent_prot,coral_percent_prot,fish_reg_total,wgi_score)

results=glm(eco_vul~ .,data=dat_select)# Model with all Xs included
Dsquared(results)  # explained deviance with all Xs included
plot(results) #all Xs included
summary(results) #all Xs included

#stepwise backward removal and addition of variables
stepAIC(results,direction = "both")

#lowest AIC model that isn't the null model
LowestAIC=glm(eco_vul~eez_percent_prot,data=dat_select)
Dsquared(LowestAIC)  # explained deviance with all Xs included
plot(LowestAIC) #all Xs included
summary(LowestAIC) #all Xs included

```


## Social Sensitivity

```{r Social Sensitivity, echo=TRUE}
library(dplyr)
library(MASS)
library(car)
library(modEvA)

head(dat)
dat_select<-dat %>%
  na.omit()%>%
  dplyr::select(soc_sen,eez_percent_prot,coral_percent_prot,fish_reg_total,wgi_score)

results=glm(soc_sen~ .,data=dat_select)# Model with all Xs included
Dsquared(results)  # explained deviance with all Xs included
plot(results) #all Xs included
summary(results) #all Xs included

#stepwise backward removal and addition of variables
stepAIC(results,direction = "both")

#lowest AIC model that isn't the null model
LowestAIC=glm(soc_sen~wgi_score,data=dat_select)
Dsquared(LowestAIC)  # explained deviance with all Xs included
plot(LowestAIC) #all Xs included
summary(LowestAIC) #all Xs included
```

## Social Adaptive Capacity

```{r Social Adaptive Capacity, echo=TRUE}
library(dplyr)
library(MASS)
library(car)
library(modEvA)

head(dat)
dat_select<-dat %>%
  na.omit()%>%
  dplyr::select(soc_ac,eez_percent_prot,coral_percent_prot,fish_reg_total,wgi_score)

results=glm(soc_ac~ .,data=dat_select)# Model with all Xs included
Dsquared(results)  # explained deviance with all Xs included
plot(results) #all Xs included
summary(results) #all Xs included

#stepwise backward removal and addition of variables
stepAIC(results,direction = "both")

#lowest AIC model that isn't the null model
LowestAIC=glm(soc_ac~fish_reg_total,data=dat_select)
Dsquared(LowestAIC)  # explained deviance with all Xs included
plot(LowestAIC) #all Xs included
summary(LowestAIC) #all Xs included
```



## Social Vulnerability

```{r Social , echo=TRUE}
library(dplyr)
library(MASS)
library(car)
library(modEvA)

head(dat)
dat_select<-dat %>%
  na.omit()%>%
  dplyr::select(se_vul,eez_percent_prot,coral_percent_prot,fish_reg_total,wgi_score)

results=glm(se_vul~ .,data=dat_select)# Model with all Xs included
Dsquared(results)  # explained deviance with all Xs included
plot(results) #all Xs included
summary(results) #all Xs 



#stepwise backward removal and addition of variables
stepAIC(results,direction = "both")

#lowest AIC model that isn't the null model
LowestAIC=glm(se_vul~fish_reg_total,data=dat_select)
Dsquared(LowestAIC)  # explained deviance with all Xs included
plot(LowestAIC) #all Xs included
summary(LowestAIC) #all Xs included

```