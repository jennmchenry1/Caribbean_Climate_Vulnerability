---
title: "GLM2"
author: "Katherine Siegel"
date: "January 9, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(dplyr)
library(MASS)
library(car)
library(modEvA)
library(betareg)
library(gamlss)
```

# Data prep
```{r}
### Read in vulnerability components and covariates
dat <- read.csv("vulnerability_covariates.csv")
dat$eez_percent_prot <- NULL

### Read in data with island independence
ind_dat <- read.csv("covariates1.csv")
keep_col <- c(1, 10, 11)
ind_dat <- ind_dat[, keep_col]
names(ind_dat) <- c("country", "ind_status", "terr_of")

### Merge two dfs
dat <- merge(dat, ind_dat, by = "country")

### Set ind_status to factor
dat$ind_status <- as.factor(dat$ind_status)
```

```{r visualizing data distribution}
boxplot(dat[c(3:8)])

#Normality test
shapiro.test(dat$eco_sens) # normal (cannot reject hypothesis that sample comes from pop with normal distribution)
shapiro.test(dat$eco_recov) #normal 
shapiro.test(dat$eco_vul) # normal
shapiro.test(dat$soc_sen) # normal
shapiro.test(dat$soc_ac) # non-normal (p = 0.01)
shapiro.test(dat$se_vul) # non-normal (p = 0.03)
```
We cannot reject the hypothesis that Ecological Sensitivity, Ecological Recovery Potential, Socioeconomic Exposure, and Socioeconomic Sensitivity come from populations with normal distributions. Socioeconomic Adaptive Capacity and Social-Ecological Vulnerability come from populations with non-normal distributions.


## Ecological Sensitivity

### Eco Sens Data (using only the subset of 24 islands with WGI scores)
### Using only ecologically relevant data
```{r Ecologial Sensitivity, echo=TRUE}
dat_select <- dat %>%
  na.omit() %>%
  dplyr::select(eco_sens, coral_percent_prot, fish_reg_total)

summary(dat_select$eco_sens)
```

### Normal error structure
```{r}
### Null model
normal_null_es <- glm(eco_sens ~ 1, data = dat_select)

### Full model
results_es <- glm(eco_sens ~ ., data = dat_select) # Model with all Xs included
Dsquared(results_es)  # explained deviance with all Xs included
summary(results_es) #all Xs included

#stepwise backward removal and addition of variables
stepAIC(results_es, direction = "both")

### lowest AIC model: just coral
LowestAIC_es <- glm(eco_sens ~ coral_percent_prot, data = dat_select)
Dsquared(LowestAIC_es)  # explained deviance with all Xs included
summary(LowestAIC_es) #all Xs included

### Just fish
es_fish <- glm(eco_sens ~ fish_reg_total, data = dat_select)
Dsquared(es_fish)
summary(es_fish)

### Compare model performances
anova(normal_null_es, results_es, test = "Chisq")
anova(normal_null_es, LowestAIC_es, test = "Chisq")
anova(normal_null_es, es_fish, test = "Chisq")
anova(results_es, LowestAIC_es, test = "Chisq")
anova(results_es, es_fish, test = "Chisq")
anova(LowestAIC_es, es_fish, test = "Chisq")

AIC(normal_null_es, results_es, LowestAIC_es, es_fish)

### Assign best normal glm
es_normal_best <- LowestAIC_es
```

### Gaussian error structure (Ecological Sensitivity)
```{r}
### Set null model (no covariates)
null <- glm(eco_sens ~ 1, data = dat_select, family = gaussian(link = "identity"))

### Build model with all covariates included
gaussian <- glm(eco_sens ~ ., data = dat_select, family = gaussian(link = "identity"))

### Assess model fit
Dsquared(gaussian)
RsqGLM(gaussian) # This is an approximation for an Rsqard
summary(gaussian)

### Check for multicollinearity
vif(gaussian) # values for each variable closer to one indicate no multicollinearity.  Higher values closer to 10 indicate the variable may be correlated with another explanatory variable.

### Visualize full model
summary(gaussian) #all Xs included

# Comparing new model to the null
anova(null, gaussian, test = "Chisq")  

# model adequacy (values above 0.05 make an adequate model)
pchisq(0.057259, gaussian$df.residual, lower.tail = FALSE)

# stepwise backward removal and addition of variables
stepAIC(gaussian, direction = "both")

# g2 (model with lowest AIC)
gaussian2 <- glm(eco_sens ~ coral_percent_prot, 
                 data = dat_select, family = gaussian(link = "identity"))
Dsquared(gaussian2) # this is the explained deviance
RsqGLM(gaussian2) #This is an approximation for an Rsqard
summary(gaussian2) #summary of lower AIC model

# Comparing new models to the null
anova(null, gaussian, gaussian2, test = "Chisq")  # an increase in residual deviance and a non-significant pvalue is a non-significant improvement from the previous model. When there isn't much of an improvment but the p values in the summary table are non-significant then should always pick the simplest model. 

anova(null, gaussian, test = "Chisq")
anova(null, gaussian2, test = "Chisq")
anova(gaussian, gaussian2, test = "Chisq")

AIC(null, gaussian, gaussian2)

### Assign Gaussian best model
gaussian_best <- gaussian2
summary(gaussian_best)
cr.plots(gaussian_best)
#model adequacy (values above 0.05 make an adequate model)
pchisq(0.058281, gaussian_best$df.residual, lower.tail = FALSE)
```

### Quasibinomial error structure (Ecological Sensitivity)
```{r}
### Null Gaussian model
qb_null <- glm(eco_sens ~ 1, data = dat_select, family = quasibinomial)

### Set full model using QB error structure
QB <- glm(eco_sens ~ ., data = dat_select, family = quasibinomial) # Model with all Xs included
Dsquared(QB)
RsqGLM(QB) #This is an approximation for an Rsqard
plot(QB) #all Xs included
summary.glm(QB) #all Xs 

#model adequacy (values above 0.05 make an adequate model)
pchisq(0.37664, QB$df.residual, lower.tail = FALSE)

# stepwise backward removal and addition of variables of full QB model
drop1(QB) ## If removal of a term increases the residual deviance, then it is not the best variable to remove

# QB2
QB2 <- glm(eco_sens ~ coral_percent_prot,
           data = dat_select,family = quasibinomial)
Dsquared(QB2)
RsqGLM(QB2) #This is an approximation for an Rsqard
summary(QB2)
pchisq(0.3767, QB2$df.residual, lower.tail = FALSE)

### QB3
QB3 <- glm(eco_sens ~ fish_reg_total,
           data = dat_select, family = quasibinomial)
Dsquared(QB3)
summary(QB3)

### ANOVAs
anova(qb_null, QB, test = "Chisq")
anova(qb_null, QB2, test = "Chisq")
anova(qb_null, QB3, test = "Chisq")
anova(QB, QB2, test = "Chisq")
anova(QB, QB3, test = "Chisq")
anova(QB2, QB3, test = "Chisq")

QB_best <- QB2
```

### Beta error structure (Ecological Sensitivity)
```{r}
### Null beta model
beta_null_es <- betareg(eco_sens ~ 1, data = dat_select)
### Full beta model
BetaGLM <- betareg(eco_sens ~., data = dat_select) 
plot(BetaGLM) #all Xs included
summary(BetaGLM) #all Xs 

# drop fish_reg (based on p values and the coefficients) 
BetaGLM2 <- betareg(eco_sens ~  coral_percent_prot, data = dat_select) 
summary(BetaGLM2)

BetaGLM3 <- betareg(eco_sens ~ fish_reg_total, data = dat_select) 
summary(BetaGLM3)

AIC(BetaGLM, BetaGLM2, BetaGLM3)

Beta_best <- BetaGLM2
```

### Compare best models using different error structures
```{r}
RsqGLM(es_normal_best)
Beta_best$pseudo.r.squared
RsqGLM(gaussian_best) 
RsqGLM(QB_best) 

### Dsquare
Dsquared(es_normal_best)
Dsquared(Beta_best)
Dsquared(gaussian_best)
Dsquared(QB_best)

## It looks like the quasibinomial model might be the best based on Rsquared. 

```
### Eco Sens Data using all 30 islands
```{r Ecologial Sensitivity, echo=TRUE}
dat_es_30 <- dat %>%
  dplyr::select(eco_sens, coral_percent_prot, fish_reg_total)
```

### Normal error structure
```{r}
### Null model
normal_null_es_30 <- glm(eco_sens ~ 1, data = dat_es_30)

### Full model
results_es_30 <- glm(eco_sens ~ ., data = dat_es_30) # Model with all Xs included
Dsquared(results_es_30)
summary(results_es_30)

#stepwise backward removal and addition of variables
stepAIC(results_es_30, direction = "both")

### lowest AIC model
LowestAIC_es_30 <- glm(eco_sens ~ coral_percent_prot, data = dat_es_30)
Dsquared(LowestAIC_es_30)
summary(LowestAIC_es_30)

### Compare model performances
anova(normal_null_es_30, results_es_30, test = "Chisq")
anova(normal_null_es_30, LowestAIC_es_30, test = "Chisq")

anova(results_es_30, LowestAIC_es_30, test = "Chisq")

AIC(normal_null_es_30, results_es_30, LowestAIC_es_30)

### Assign best normal glm
es_normal_best_30 <- LowestAIC_es_30
```

### Gaussian error structure (Ecological Sensitivity)
```{r}
### Set null model (no covariates)
null_30 <- glm(eco_sens ~ 1, data = dat_es_30, family = gaussian(link = "identity"))

### Build model with all covariates included
gaussian_30 <- glm(eco_sens ~ ., 
                   data = dat_es_30, family = gaussian(link = "identity"))

### Assess model fit
Dsquared(gaussian_30)
RsqGLM(gaussian_30) # This is an approximation for an Rsqard

### Check for multicollinearity
vif(gaussian_30) # values for each variable closer to one indicate no multicollinearity.  Higher values closer to 10 indicate the variable may be correlated with another explanatory variable.

### Visualize full model
summary(gaussian_30) #all Xs included

#model adequacy (values above 0.05 make an adequate model)
pchisq(0.057259, gaussian_30$df.residual, lower.tail = FALSE)

#stepwise backward removal and addition of variables
stepAIC(gaussian_30, direction = "both")

#g2 (model with lowest AIC)
gaussian2_30 <- glm(eco_sens ~ coral_percent_prot, 
                 data = dat_es_30, family = gaussian(link = "identity"))
Dsquared(gaussian2_30) # this is the explained deviance
RsqGLM(gaussian2_30) #This is an approximation for an Rsqard
plot(gaussian2_30) #plots for lower AIC model
summary(gaussian2_30) #summary of lower AIC model

# Comparing new models
anova(null_30, gaussian_30, test = "Chisq") 
anova(null_30, gaussian2_30, test = "Chisq")

anova(gaussian_30, gaussian2_30, test = "Chisq")

AIC(null_30, gaussian_30, gaussian2_30)

### Assign Gaussian best model
gaussian_best_30 <- gaussian2_30
summary(gaussian_best_30)
cr.plots(gaussian_best_30)
#model adequacy (values above 0.05 make an adequate model)
pchisq(0.058281, gaussian_best_30$df.residual, lower.tail = FALSE)
```

### Quasibinomial error structure (Ecological Sensitivity)
```{r}
### Null Gaussian model
qb_null_30 <- glm(eco_sens ~ 1, data = dat_es_30, family = quasibinomial)

### Set full model using QB error structure
QB_30 <- glm(eco_sens ~ ., data = dat_es_30, family = quasibinomial) # Model with all Xs included
Dsquared(QB_30)
RsqGLM(QB_30)
plot(QB_30)
summary.glm(QB_30)

#model adequacy (values above 0.05 make an adequate model)
pchisq(0.37664, QB_30$df.residual, lower.tail = FALSE)

# stepwise backward removal and addition of variables of full QB model
drop1(QB_30) ## If removal of a term increases the residual deviance, then it is not the best variable to remove

# QB2: drop fish_reg
QB2_30 <- glm(eco_sens ~ coral_percent_prot,
           data = dat_es_30, family = quasibinomial)
Dsquared(QB2_30)
RsqGLM(QB2_30) #This is an approximation for an Rsqard
summary(QB2_30)
pchisq(0.3767, QB2_30$df.residual, lower.tail = FALSE)

### ANOVAs
anova(qb_null_30, QB_30, test = "Chisq")
anova(qb_null_30, QB2_30, test = "Chisq")
anova(QB_30, QB2_30, test = "Chisq")

QB_best_30 <- QB2_30
```

### Beta error structure (Ecological Sensitivity)
```{r}
### Null beta model
beta_null_es_30 <- betareg(eco_sens ~ 1, data = dat_es_30)
### Full beta model
BetaGLM_30 <- betareg(eco_sens ~., data = dat_es_30) 
summary(BetaGLM_30) #all Xs 

# drop fish_reg (based on p values and the coefficients) 
BetaGLM2_30 <- betareg(eco_sens ~ coral_percent_prot, data = dat_es_30) 
summary(BetaGLM2_30)

# drop coral
BetaGLM3_30 <- betareg(eco_sens ~ fish_reg_total, data = dat_es_30) 
summary(BetaGLM3_30)

AIC(BetaGLM_30, BetaGLM2_30, BetaGLM3_30)

### Assign best
Beta_best_30 <- BetaGLM2_30
```

### Compare best models using different error structures
```{r}
RsqGLM(es_normal_best_30)
Beta_best_30$pseudo.r.squared
RsqGLM(gaussian_best_30) 
RsqGLM(QB_best_30)

### Dsq
Dsquared(es_normal_best_30)
Dsquared(gaussian_best_30)
Dsquared(QB_best_30)
```

## Ecological Recovery
```{r Ecologial Recovery, echo=TRUE}
### Create df for eco_recov
dat_select_erp <- dat %>%
  na.omit() %>%
  dplyr::select(eco_recov, coral_percent_prot, fish_reg_total)

### Normal null
normal_null_erp <- glm(eco_recov ~ 1, data =  dat_select_erp)

### Full model
results_erp <- glm(eco_recov ~ ., data = dat_select_erp) # Model with all Xs included
Dsquared(results_erp)  
plot(results_erp) 
summary(results_erp) 

#stepwise backward removal and addition of variables
stepAIC(results_erp, direction = "both")

#lowest AIC model that isn't the null model
LowestAIC_erp <- glm(eco_recov ~ fish_reg_total, data = dat_select_erp)
Dsquared(LowestAIC_erp)
plot(LowestAIC_erp)
summary(LowestAIC_erp)


### ANOVAs
anova(normal_null_erp, results_erp, test = "Chisq")
anova(normal_null_erp, LowestAIC_erp, test = "Chisq")
anova(results_erp, LowestAIC_erp, test = "Chisq")

### AIC
AIC(normal_null_erp, results_erp, LowestAIC_erp)

### Assign best non-null normal
best_normal_erp <- LowestAIC_erp
```

### Gaussian error structure (Ecological Recovery)
```{r}
### set Gaussian null model
null_erp <- glm(eco_recov ~ 1, data = dat_select_erp, 
                family = gaussian(link = "identity"))

### Gaussian full model
gaussian_erp <- glm(eco_recov ~ ., data = dat_select_erp, 
                    family = gaussian(link = "identity"))
Dsquared(gaussian_erp)
RsqGLM(gaussian_erp) 
vif(gaussian_erp) # all values below 1.5
plot(gaussian_erp) # all Xs included
summary(gaussian_erp) # all Xs included

# model adequacy (values above 0.05 make an adequate model)
pchisq(0.085511 - 0.057259, gaussian_erp$df.null - gaussian_erp$df.residual, lower.tail = FALSE) ## 0.99

# stepwise backward removal and addition of variables
stepAIC(gaussian_erp, direction = "both")

# Best non-null AIC model
gaussian2_erp <- glm(eco_recov ~ fish_reg_total, 
                     data = dat_select_erp, family = gaussian(link = "identity")) 
Dsquared(gaussian2_erp) # very low explained deviance (less than full model)
summary(gaussian2_erp) # This is an approximation for an Rsqard

# ANOVAs
anova(null_erp, gaussian_erp, test = "Chisq")  # a decrease in deviance but a non-significant pvalue is a non-significant improvement
anova(null_erp, gaussian2_erp, test = "Chisq") 
anova(gaussian_erp, gaussian2_erp, test = "Chisq")

# for anovas: decrease in residual deviance but a non-significant pvalue is a non-significant improvement from the previous model. When there isn't much of an improvment but the p values in the summary table are non-significant then should always pick the simplest model --> null model is better than gaussian2_erp 

AIC(null_erp, gaussian_erp, gaussian2_erp)

### Best non-null Gaussian model
gaussian_best_erp  <- gaussian2_erp
#model adequacy (values above 0.05 make an adequate model)
pchisq(0.058281, gaussian_best_erp$df.residual, lower.tail = FALSE)
```
The best Gaussian model is the null model. The best non-null model is eco_recov ~ fish_reg (based on AIC)

### Quasibinomial error structure (Ecological Recovery)
```{r}
# Create full model
QB_erp <- glm(eco_recov ~ ., data = dat_select_erp, family = quasibinomial)
Dsquared(QB_erp)
RsqGLM(QB_erp) #This is an approximation for an Rsqard
plot(QB_erp) #all Xs included
summary.glm(QB_erp) #all Xs 

### Create QB null
qb_null_erp <- glm(eco_recov ~ 1, data = dat_select_erp, family = quasibinomial)

# model adequacy (values above 0.05 make an adequate model)
pchisq(0.37664, QB_erp$df.residual, lower.tail = FALSE)

#stepwise backward removal and addition of variables of full QB model
drop1(QB_erp) ### shouldn't drop any of them (because deviance increases in all cases)
### looks like QB is not a good model for ecological recovery potential

### Try dropping coral_percent
QB_erp_2 <- glm(eco_recov ~ fish_reg_total, 
                data = dat_select_erp, family = quasibinomial)
Dsquared(QB_erp_2)
summary(QB_erp_2)

### Anovas 
anova(qb_null_erp, QB_erp, test = "Chisq") 
anova(qb_null_erp, QB_erp_2, test = "Chisq")
anova(QB_erp, QB_erp_2, test = "Chisq")

### Set best non-null QB (full)
best_qb_erp <- QB_erp_2
```
Looks like quasibinomial error structures don't perform well for eco_recov. The full quasibinomial model does not fit better than the null quasibinomial model.

### Beta error structure (Ecological Recovery)
```{r}
### Full model with beta error
BetaGLM_erp <- betareg(eco_recov ~., data = dat_select_erp) 
summary(BetaGLM_erp) #all Xs 

### drop coral_percent_prot
BetaGLM2_erp <- betareg(eco_recov ~ fish_reg_total, data = dat_select_erp) 
summary(BetaGLM2_erp)

### Compare AICs
AIC(BetaGLM_erp, BetaGLM2_erp)
### BetaGLM2_erp (just fish_reg_total) has the lowest AIC

### Test performance of BetaGLM4_erp
pchisq(0.37664, BetaGLM2_erp$df.residual, lower.tail = FALSE)

### Set best beta model
best_beta_erp <- BetaGLM2_erp
```

### Compare best models (Ecological Recovery Potential)
```{r}
best_beta_erp$pseudo.r.squared
RsqGLM(gaussian_best_erp) 
RsqGLM(best_qb_erp) 
RsqGLM(best_normal_erp)

### Dsq
Dsquared(gaussian_best_erp)
Dsquared(best_qb_erp)
Dsquared(best_normal_erp)
```
Using Cox-Snell R2 approximations, the Gaussian and normal models have the best fit. However, their R2 values are very low!

## Ecological Recovery with all 30 islands
### Normal error structure
```{r Ecologial Recovery, echo=TRUE}
### Create df for eco_recov
dat_select_erp_30 <- dat %>%
  dplyr::select(eco_recov, coral_percent_prot, fish_reg_total)

### Normal null
normal_null_erp_30 <- glm(eco_recov ~ 1, data =  dat_select_erp_30)

### Full model
results_erp_30 <- glm(eco_recov ~ ., data = dat_select_erp_30) 
Dsquared(results_erp_30)  
summary(results_erp_30)

#stepwise backward removal and addition of variables
stepAIC(results_erp_30, direction = "both")

#lowest AIC model that isn't the null model
LowestAIC_erp_30 <- glm(eco_recov ~ coral_percent_prot, data = dat_select_erp_30)
Dsquared(LowestAIC_erp_30)
summary(LowestAIC_erp_30)

### ANOVAs
anova(normal_null_erp_30, results_erp_30, test = "Chisq")
anova(normal_null_erp_30, LowestAIC_erp_30, test = "Chisq")
anova(results_erp_30, LowestAIC_erp_30, test = "Chisq")

### AIC
AIC(results_erp_30, LowestAIC_erp_30)

### Assign best non-null normal
best_normal_erp_30 <- LowestAIC_erp_30
```

### Gaussian error structure (Ecological Recovery), 30 islands
```{r}
### set Gaussian null model
null_erp_30 <- glm(eco_recov ~ 1, data = dat_select_erp_30, 
                   family = gaussian(link = "identity"))

### Gaussian full model
gaussian_erp_30 <- glm(eco_recov ~ ., data = dat_select_erp_30, 
                       family = gaussian(link = "identity"))
Dsquared(gaussian_erp_30)
vif(gaussian_erp_30) # all values below 1.5
summary(gaussian_erp_30) # all Xs included

# model adequacy (values above 0.05 make an adequate model)
pchisq(0.085511 - 0.057259, gaussian_erp_30$df.null - gaussian_erp_30$df.residual, 
       lower.tail = FALSE) 

# stepwise backward removal and addition of variables
stepAIC(gaussian_erp_30, direction = "both")

# Best non-null AIC model
gaussian2_erp_30 <- glm(eco_recov ~ coral_percent_prot, 
                     data = dat_select_erp_30, family = gaussian(link = "identity")) 
Dsquared(gaussian2_erp_30) # very low explained deviance (less than full model)
summary(gaussian2_erp_30) # This is an approximation for an Rsqared

### ANOVAs
anova(null_erp_30, gaussian_erp_30, test = "Chisq")
anova(null_erp_30, gaussian2_erp_30, test = "Chisq")
anova(gaussian_erp_30, gaussian2_erp_30, test = "Chisq")

### AIC
AIC(gaussian_erp_30, gaussian2_erp_30)

### Assign best non-null normal
best_gaussian_erp_30 <- gaussian2_erp_30
```

### Quasibinomial error structure (Ecological Recovery), 30 islands
```{r}
# Create full model
QB_erp_30 <- glm(eco_recov ~ ., data = dat_select_erp_30, family = quasibinomial)
Dsquared(QB_erp_30)
summary.glm(QB_erp_30) #all Xs 

### Create QB null
qb_null_erp_30 <- glm(eco_recov ~ 1, data = dat_select_erp_30, family = quasibinomial)

# model adequacy (values above 0.05 make an adequate model)
pchisq(0.37664, QB_erp_30$df.residual, lower.tail = FALSE)

#stepwise backward removal and addition of variables of full QB model
drop1(QB_erp_30) ### shouldn't drop any of them (because deviance increases in all cases)

### Just coral
qb_2_erp_30 <- glm(eco_recov ~ coral_percent_prot, data = dat_select_erp_30, 
                   family = quasibinomial)
Dsquared(qb_2_erp_30)
summary.glm(qb_2_erp_30)

### ANOVA
anova(qb_null_erp_30, QB_erp_30, test = "Chisq")
anova(qb_null_erp_30, qb_2_erp_30, test = "Chisq")
anova(QB_erp_30, qb_2_erp_30, test = "Chisq")
```

### Beta error structure (Ecological Recovery), 30 islands
```{r}
### Full model with beta error
BetaGLM_erp_30 <- betareg(eco_recov ~., data = dat_select_erp_30) 
summary(BetaGLM_erp_30) 

### Just fish_reg
BetaGLM2_erp_30 <- betareg(eco_recov ~ fish_reg_total, 
                           data = dat_select_erp_30) 
summary(BetaGLM2_erp_30)

### Just coral
BetaGLM3_erp_30 <- betareg(eco_recov ~ coral_percent_prot, data = dat_select_erp_30) 
summary(BetaGLM3_erp_30)

### Compare AICs
AIC(BetaGLM_erp_30, BetaGLM2_erp_30, BetaGLM3_erp_30)
### BetaGLM3_erp (just coral) has the lowest AIC

### Test performance of BetaGLM3_erp_30
pchisq(0.37664, BetaGLM3_erp_30$df.residual, lower.tail = FALSE)

### Set best beta model
best_beta_erp_30 <- BetaGLM3_erp_30
```

```{r}
best_beta_erp_30$pseudo.r.squared
```

## Socioeconomic Exposure (Ecological Vulnerability)
```{r Ecologial Vulnerability, echo=TRUE}
### df for socioeconomic exposure
dat_select_se <- dat %>%
  na.omit() %>%
  dplyr::select(eco_vul, coral_percent_prot, fish_reg_total, wgi_score, ind_status)

### Full model
results_se <- glm(eco_vul ~ ., data = dat_select_se) # Model with all Xs included
Dsquared(results_se)  # explained deviance with all Xs included
plot(results_se) #all Xs included
summary(results_se) #all Xs included

### Null model
normal_null_se <- glm(eco_vul ~ 1, data = dat_select_se)

#stepwise backward removal and addition of variables
stepAIC(results_se, direction = "both")

#lowest AIC model that isn't the null model
LowestAIC_se <- glm(eco_vul ~ ind_status, data = dat_select_se)
Dsquared(LowestAIC_se)  
summary(LowestAIC_se)

### 2nd lowest AIC 
LowestAIC_se_2 <- glm(eco_vul ~ ind_status + wgi_score, data = dat_select_se)
Dsquared(LowestAIC_se_2)  
summary(LowestAIC_se_2)

### ANOVAs between full and lowest AIC
anova(normal_null_se, results_se, test = "Chisq")
anova(normal_null_se, LowestAIC_se, test = "Chisq")
anova(normal_null_se, LowestAIC_se_2, test = "Chisq")
anova(results_se, LowestAIC_se, test = "Chisq")
anova(results_se, LowestAIC_se_2, test = "Chisq")
anova(LowestAIC_se, LowestAIC_se_2, test = "Chisq")

### AIC
AIC(results_se, LowestAIC_se, LowestAIC_se_2)
```


### Gaussian error structure (Socioeconomic exposure)
```{r}
### Gaussian null model
null_se <- glm(eco_vul ~ 1, data = dat_select_se, family = gaussian(link = "identity"))

### Gaussian full model
gaussian_se <- glm(eco_vul ~ ., data = dat_select_se, family = gaussian(link = "identity"))
Dsquared(gaussian_se)
RsqGLM(gaussian_se) 
vif(gaussian_se) # all values below 1.5
plot(gaussian_se) # all Xs included
summary(gaussian_se) # all Xs included

# model adequacy (values above 0.05 make an adequate model)
pchisq(0.085511 - 0.057259, gaussian_se$df.null - gaussian_se$df.residual, lower.tail = FALSE) ## 0.9999

# stepwise backward removal and addition of variables
stepAIC(gaussian_se, direction = "both")

# Best non-null AIC model
gaussian2_se <- glm(eco_vul ~ ind_status, data = dat_select_se, 
                    family = gaussian(link = "identity")) 
Dsquared(gaussian2_se) # very low explained deviance (less than full model)
summary(gaussian2_se) # This is an approximation for an Rsqared

# anovas
anova(null_se, gaussian_se, test = "Chisq") 
anova(null_se, gaussian2_se, test = "Chisq")
anova(gaussian_se, gaussian2_se, test = "Chisq")

### AIC
AIC(gaussian_se, gaussian2_se)

### Best Gaussian model is null model. Best non-null model: gaussian2_se
gaussian_best_se <- gaussian2_se
#model adequacy (values above 0.05 make an adequate model)
pchisq(0.058281, gaussian_best_se$df.residual, lower.tail = FALSE)
```

### Quasibinomial error structure (Socioeconomic exposure)
```{r}
# Create full model
QB_se <- glm(eco_vul ~ ., data = dat_select_se, family = quasibinomial)
Dsquared(QB_se)
RsqGLM(QB_se) 
plot(QB_se)
summary.glm(QB_se) 

### Create QB null
qb_null_se <- glm(eco_vul ~ 1, data = dat_select_se, family = quasibinomial)

# model adequacy (values above 0.05 make an adequate model)
pchisq(0.37664, QB_se$df.residual, lower.tail = FALSE)

#stepwise backward removal and addition of variables of full QB model
drop1(QB_se) ### shouldn't drop any of them (because deviance increases in all cases)

### Try just ind
qb_se_ind <- glm(eco_vul ~ ind_status, data = dat_select_se,
                 family = quasibinomial)
Dsquared(qb_se_ind)
summary(qb_se_ind)

### Run anova between full and null QBs
anova(qb_null_se, QB_se, test = "Chisq")
anova(qb_null_se, qb_se_ind, test = "Chisq")
anova(QB_se, qb_se_ind, test = "Chisq")

### Best non-null QB model
best_qb_se <- qb_se_ind
```


### Beta error structure (Socioeconomic exposure)
```{r}
### Full model with beta error
BetaGLM_se <- betareg(eco_vul ~., data = dat_select_se) 
summary(BetaGLM_se)

### Null model with beta error
BetaGLM_null_se <- betareg(eco_vul ~ 1, data = dat_select_se) 

### Manually run through alternative models and look at the p values and the coefficients 
### 3 variables (drop coral_percent_prot)
BetaGLM2_se <- betareg(eco_vul ~  fish_reg_total + wgi_score + ind_status, data = dat_select_se) 
summary(BetaGLM2_se)

### 2 variables (drop fish)
BetaGLM3_se <- betareg(eco_vul ~ wgi_score + ind_status, data = dat_select_se) 
summary(BetaGLM3_se)

### Single variable
BetaGLM4_se <- betareg(eco_vul ~ wgi_score, data = dat_select_se)
summary(BetaGLM4_se)

BetaGLM5_se <- betareg(eco_vul ~ ind_status, data = dat_select_se) 
summary(BetaGLM5_se) ## best beta GLM by AIC

BetaGLM6_se <- betareg(eco_vul ~ coral_percent_prot, data = dat_select_se) 
summary(BetaGLM6_se)

BetaGLM7_se <- betareg(eco_vul ~ fish_reg_total, data = dat_select_se) 
summary(BetaGLM7_se)

### Compare AICs
AIC(BetaGLM_se, BetaGLM2_se, BetaGLM3_se, BetaGLM4_se,
    BetaGLM5_se, BetaGLM6_se, BetaGLM7_se)


### Test performance of BetaGLM5_se
anova(null_se, BetaGLM5_se, test = "Chisq") 
pchisq(0.37664, BetaGLM5_se$df.residual, lower.tail = FALSE)

### Best non-null beta model
best_beta_se <- BetaGLM5_se
```
The beta model with the lowest AIC is the null model, followed by the model with just eez_percent_prot.

### Compare best models (Socioeconomic Exposure)
```{r}
best_beta_se$pseudo.r.squared 
RsqGLM(gaussian_best_se) 
RsqGLM(best_qb_se) ### CoxSnell = NA, Tjur = NA, Pearson = 0.08272368
RsqGLM(LowestAIC_se) ### CoxSnell = 0.06619622, Tjur = NA, Pearson = 0.06619622

### Dsq
Dsquared(gaussian_best_se)
Dsquared(best_qb_se)
Dsquared(LowestAIC_se)
```

## Social Sensitivity
```{r Social Sensitivity, echo=TRUE}
### df for socioeconomic sensitivity
dat_select_ss <- dat %>%
  na.omit() %>%
  dplyr::select(soc_sen, coral_percent_prot, fish_reg_total, wgi_score, ind_status)

### Full model
results_ss <- glm(soc_sen ~ ., data = dat_select_ss) # Model with all Xs included
Dsquared(results_ss)  # explained deviance with all Xs included
plot(results_ss) #all Xs included
summary(results_ss) #all Xs included

### Null model
null_normal_ss <- glm(soc_sen ~ 1, data = dat_select_ss)

#stepwise backward removal and addition of variables
stepAIC(results_ss, direction = "both")

#lowest AIC model that isn't the null model
LowestAIC_ss <- glm(soc_sen ~ wgi_score, data = dat_select_ss)
Dsquared(LowestAIC_ss)
summary(LowestAIC_ss) 

### 2nd lowest AIC model
LowestAIC2_ss <- glm(soc_sen ~ fish_reg_total + wgi_score, data = dat_select_ss)
Dsquared(LowestAIC2_ss)
summary(LowestAIC2_ss) 

### 3rd lowest
LowestAIC3_ss <- glm(soc_sen ~ fish_reg_total + wgi_score + ind_status, data = dat_select_ss)
Dsquared(LowestAIC3_ss)
summary(LowestAIC3_ss)

### wgi and ind
wgi_ind <- glm(soc_sen ~ wgi_score + ind_status, data = dat_select_ss)
Dsquared(wgi_ind)
summary(wgi_ind)

### anovas
anova(null_normal_ss, results_ss, test = "Chisq")
anova(null_normal_ss, LowestAIC_ss, test = "Chisq")
anova(null_normal_ss, LowestAIC2_ss, test = "Chisq")
anova(null_normal_ss, LowestAIC3_ss, test = "Chisq")

### vs full
anova(results_ss, LowestAIC_ss, test = "Chisq")
anova(results_ss, LowestAIC2_ss, test = "Chisq")
anova(results_ss, LowestAIC3_ss, test = "Chisq")

### vs wgi only
anova(LowestAIC2_ss, LowestAIC_ss, test = "Chisq")
anova(LowestAIC3_ss, LowestAIC_ss, test = "Chisq")

### AIC
AIC(results_ss, LowestAIC_ss, LowestAIC2_ss, LowestAIC3_ss, wgi_ind)
```
The full model has lower residual deviance than the null model (but not significantly so). The lowest AIC model (wgi_score) does not perform significantly better than the full model, but it does perform significantly better than the null model (lower residual deviance, p = 0.009).

### Gaussian error structure (Socioeconomic sensitivity)
```{r}
### Gaussian null model
null_gaus_ss <- glm(soc_sen ~ 1, data = dat_select_ss, family = gaussian(link = "identity"))

### Gaussian full model
gaussian_ss <- glm(soc_sen ~ ., data = dat_select_ss, family = gaussian(link = "identity"))
Dsquared(gaussian_ss)
RsqGLM(gaussian_ss) 
vif(gaussian_ss) # all values below 1.5
plot(gaussian_ss) # all Xs included
summary(gaussian_ss) # all Xs included

# model adequacy (values above 0.05 make an adequate model)
pchisq(0.085511 - 0.057259, gaussian_ss$df.null - gaussian_ss$df.residual, lower.tail = FALSE) ## 0.9999

# stepwise backward removal and addition of variables
stepAIC(gaussian_ss, direction = "both")

# Best non-null AIC model (wgi_score)
gaussian2_ss <- glm(soc_sen ~ wgi_score, data = dat_select_ss, 
                    family = gaussian(link = "identity")) 
Dsquared(gaussian2_ss) # very low explained deviance (less than full model)
RsqGLM(gaussian2_ss) # This is an approximation for an Rsqard
summary(gaussian2_ss)

# anovas
anova(null_gaus_ss, gaussian_ss, test = "Chisq")  
anova(null_gaus_ss, gaussian2_ss, test = "Chisq")
anova(gaussian_ss, gaussian2_ss, test = "Chisq") 

AIC(gaussian_ss, gaussian2_ss)

### Assign Gaussian best model
gaussian_best_ss <- gaussian2_ss
summary(gaussian_best_ss)
cr.plots(gaussian_best_ss)
#model adequacy (values above 0.05 make an adequate model)
pchisq(0.058281, gaussian_best_ss$df.residual, lower.tail = FALSE)
```

### Quasibinomial error structure (Socioeconomic sensitivity)
```{r}
# Create full model
QB_ss <- glm(soc_sen ~ ., data = dat_select_ss, family = quasibinomial)
Dsquared(QB_ss)
summary.glm(QB_ss) 

### Create QB null
qb_null_ss <- glm(soc_sen ~ 1, data = dat_select_ss, family = quasibinomial)

# model adequacy (values above 0.05 make an adequate model)
pchisq(0.37664, QB_ss$df.residual, lower.tail = FALSE)

#stepwise backward removal and addition of variables of full QB model
drop1(QB_ss) ### shouldn't drop any of them (because deviance increases in all cases)
### looks like QB is not a good model for ecological recovery potential

### try dropping one variable (leave in wgi because sig predictor)
qb_ss_drop_eez <- glm(soc_sen ~ coral_percent_prot + fish_reg_total + wgi_score, 
                      data = dat_select_ss, family = quasibinomial)
qb_ss_drop_coral <- glm(soc_sen ~ ind_status + fish_reg_total + wgi_score, 
                        data = dat_select_ss, family = quasibinomial)
qb_ss_drop_fish <- glm(soc_sen ~ ind_status + coral_percent_prot + wgi_score, 
                       data = dat_select_ss, family = quasibinomial)

### Try just WGI
qb_ss_wgi <- glm(soc_sen ~ wgi_score, data = dat_select_ss, family = quasibinomial)
Dsquared(qb_ss_wgi)
summary(qb_ss_wgi)

### Run anova with null QBs
anova(qb_null_ss, QB_ss, test = "Chisq")
anova(qb_null_ss, qb_ss_drop_eez, test = "Chisq")
anova(qb_null_ss, qb_ss_drop_coral, test = "Chisq")
anova(qb_null_ss, qb_ss_drop_fish, test = "Chisq")
anova(qb_null_ss, qb_ss_wgi, test = "Chisq")

### anova with full QBs
anova(QB_ss, qb_ss_drop_eez, test = "Chisq")
anova(QB_ss, qb_ss_drop_coral, test = "Chisq")
anova(QB_ss, qb_ss_drop_fish, test = "Chisq")
anova(QB_ss, qb_ss_wgi, test = "Chisq")

### anova with WGI only model
anova(qb_ss_wgi, qb_ss_drop_eez, test = "Chisq")
anova(qb_ss_wgi, qb_ss_drop_coral, test = "Chisq")
anova(qb_ss_wgi, qb_ss_drop_fish, test = "Chisq")

### Set best non-null qb model
best_qb_ss <- qb_ss_wgi
```
The D2 for the full model is 0.26. It does not perform better than the Gaussian null. It performs insignificantly better than the QB null. The QB null does not perform better than the Gaussian null.

Dropping any one variable from the full model reduces the deviance. However, the only significant variable in the model is wgi_score, and according to anova, the full model does not perform significantly better than the wgi_only model.


### Beta error structure (Socioeconomic sensitivity)
```{r}
### Full model with beta error
BetaGLM_ss <- betareg(soc_sen ~., data = dat_select_ss) 
summary(BetaGLM_ss)

### Null model with beta error
BetaGLM_null_ss <- betareg(soc_sen ~ 1, data = dat_select_ss) 

### Manually run through alternative models and look at the p values and the coefficients 
### 3 variables (drop coral_percent_prot)
BetaGLM2_ss <- betareg(soc_sen ~ fish_reg_total + wgi_score + ind_status, data = dat_select_ss) 
summary(BetaGLM2_ss)

### 2 variables (drop ind_status)
BetaGLM3_ss <- betareg(soc_sen ~ fish_reg_total + wgi_score, data = dat_select_ss) 
summary(BetaGLM3_ss) # best beta GLM

### Single variable
BetaGLM4_ss <- betareg(soc_sen ~ wgi_score, data = dat_select_ss)
summary(BetaGLM4_ss)

BetaGLM5_ss <- betareg(soc_sen ~ fish_reg_total, data = dat_select_ss) 
summary(BetaGLM5_ss)

### Compare AICs
AIC(BetaGLM_ss, BetaGLM2_ss, BetaGLM3_ss, 
    BetaGLM4_ss, BetaGLM5_ss)
### BetaGLM4_ss (just wgi_score) has the lowest AIC

### Test performance of BetaGLM4_ss
pchisq(0.37664, BetaGLM4_ss$df.residual, lower.tail = FALSE)

### Best non-null beta model
best_beta_ss <- BetaGLM4_ss
```

### Compare best models (Socioeconomic Sensitivity)
```{r}
best_beta_ss$pseudo.r.squared
RsqGLM(gaussian_best_ss) 
RsqGLM(best_qb_ss) 
RsqGLM(LowestAIC_ss)

### Dsq
Dsquared(gaussian_best_ss)
Dsquared(best_qb_ss)
Dsquared(LowestAIC_ss)
```
Based on R2 values, the best model is the normal or Gaussian (soc_sen ~ wgi_score)


## Social Adaptive Capacity
```{r Social Adaptive Capacity, echo=TRUE}
### df for social adaptive capacity
dat_select_sac <- dat %>%
  na.omit() %>%
  dplyr::select(soc_ac, coral_percent_prot, fish_reg_total, wgi_score, ind_status)

### Full model
results_sac <- glm(soc_ac ~ ., data = dat_select_sac) # Model with all Xs included
Dsquared(results_sac)  
plot(results_sac) #all Xs included
summary(results_sac) #all Xs included

### Null
sac_null <- glm(soc_ac ~ 1, data = dat_select_sac)

#stepwise backward removal and addition of variables
stepAIC(results_sac, direction = "both")

#lowest AIC model that isn't the null model
LowestAIC_sac <- glm(soc_ac ~ fish_reg_total + ind_status, data = dat_select_sac)
Dsquared(LowestAIC_sac) 
plot(LowestAIC_sac)
summary(LowestAIC_sac) 

#2nd lowest AIC model 
LowestAIC2_sac <- glm(soc_ac ~ fish_reg_total + wgi_score + ind_status, 
                      data = dat_select_sac)
Dsquared(LowestAIC2_sac) 
plot(LowestAIC2_sac)
summary(LowestAIC2_sac) 

### ANOVA
anova(sac_null, results_sac, test = "Chisq")
anova(sac_null, LowestAIC_sac, test = "Chisq")
anova(sac_null, LowestAIC2_sac, test = "Chisq")
anova(results_sac, LowestAIC_sac, test = "Chisq")
anova(results_sac, LowestAIC2_sac, test = "Chisq")
anova(LowestAIC_sac, LowestAIC2_sac, test = "Chisq")

AIC(results_sac, LowestAIC_sac, LowestAIC2_sac)
```

### Gaussian error structure (Socioeconomic adaptive capacity)
```{r}
### Gaussian null model
null_gaus_sac <- glm(soc_ac ~ 1, data = dat_select_sac, 
                     family = gaussian(link = "identity"))

### Gaussian full model
gaussian_sac <- glm(soc_ac ~ ., data = dat_select_sac, 
                    family = gaussian(link = "identity"))
Dsquared(gaussian_sac) ### 0.3180984
RsqGLM(gaussian_sac) 
vif(gaussian_sac) # all values below 1.5
plot(gaussian_sac) # all Xs included
summary(gaussian_sac) # all Xs included

# Comparing full model to the null
anova(null_gaus_sac, gaussian_sac, test = "Chisq")  # a decrease in deviance but a non-significant pvalue is a non-significant improvement

# model adequacy (values above 0.05 make an adequate model)
pchisq(0.085511 - 0.057259, gaussian_sac$df.null - gaussian_sac$df.residual, lower.tail = FALSE) ## 0.9999

# stepwise backward removal and addition of variables
stepAIC(gaussian_sac, direction = "both")

# Best non-null AIC model (fish_reg_total + ind_status)
gaussian2_sac <- glm(soc_ac ~ fish_reg_total + ind_status, 
                     data = dat_select_sac, family = gaussian(link = "identity")) 
Dsquared(gaussian2_sac) 
summary(gaussian2_sac)
RsqGLM(gaussian2_sac)

# Comparing new model to the null
anova(null_gaus_sac, gaussian2_sac, test = "Chisq")  # significant decrease in residual deviance!

### Assign Gaussian best model
gaussian_best_sac <- gaussian2_sac
summary(gaussian_best_sac)
cr.plots(gaussian_best_sac)
#model adequacy (values above 0.05 make an adequate model)
pchisq(0.058281, gaussian_best_sac$df.residual, lower.tail = FALSE)
```
The best Gaussian model is soc_ac ~ fish_reg_total + ind_status. 

### Quasibinomial error structure (Socioeconomic adaptive capacity)
```{r}
# Create full model
QB_sac <- glm(soc_ac ~ ., data = dat_select_sac, family = quasibinomial)
Dsquared(QB_sac) ### 0.3151179
RsqGLM(QB_sac) 
plot(QB_sac)
summary.glm(QB_sac) 

### Create QB null
qb_null_sac <- glm(soc_ac ~ 1, data = dat_select_sac, family = quasibinomial)

### Run anova between full and null QBs
anova(qb_null_sac, QB_sac, test = "Chisq") # the full model does not perform significantly better than the QB null

# model adequacy (values above 0.05 make an adequate model)
pchisq(0.37664, QB_sac$df.residual, lower.tail = FALSE)

#stepwise backward removal and addition of variables of full QB model
drop1(QB_sac) ### shouldn't drop any of them (because deviance increases in all cases)
### but smallest increase in deviance from dropping eez and wgi

### Drop eez and wgi (b/c smallest decrease in deviance)
qb_sac_coral_fish <- glm(soc_ac ~ coral_percent_prot + fish_reg_total,
                         data = dat_select_sac, family = quasibinomial)
Dsquared(qb_sac_coral_fish)
summary(qb_sac_coral_fish)

### Fish only
qb_sac_fish <- glm(soc_ac ~ fish_reg_total,
                         data = dat_select_sac, family = quasibinomial)
Dsquared(qb_sac_fish)
summary(qb_sac_fish)

### anova against null
anova(qb_null_sac, QB_sac, test = "Chisq")
anova(qb_null_sac, qb_sac_coral_fish, test = "Chisq")
anova(qb_null_sac, qb_sac_fish, test = "Chisq")

### anova against full
anova(QB_sac, qb_sac_coral_fish, test = "Chisq")
anova(QB_sac, qb_sac_fish, test = "Chisq")

### 2 var vs 1 var
anova(qb_sac_coral_fish, qb_sac_fish, test = "Chisq")

anova(qb_sac_fish, QB_sac, test = "Chisq")

### Set best non-null qb model
best_qb_sac <- qb_sac_fish
```

The QB full model does not perform better than the QB null (reduced residual deviance, but p = 0.06), but it is the best non-null model.

### Beta error structure (Socioeconomic adaptive capacity)
```{r}
### Full model with beta error
BetaGLM_sac <- betareg(soc_ac ~., data = dat_select_sac) 
summary(BetaGLM_sac)

### Null model with beta error
BetaGLM_null_sac <- betareg(soc_ac ~ 1, data = dat_select_sac) 

### Manually run through alternative models and look at the p values and the coefficients 
### 3 variables (drop coral_percent_prot)
BetaGLM2_sac <- betareg(soc_ac ~ eez_percent_prot + fish_reg_total + wgi_score, data = dat_select_sac) 
summary(BetaGLM2_sac)

### 3 variables (drop wgi_score)
BetaGLM3_sac <- betareg(soc_ac ~ eez_percent_prot + fish_reg_total + coral_percent_prot, 
                        data = dat_select_sac) 
summary(BetaGLM3_sac)

### 2 variables (drop coral_percent_prot and wgi_score)
BetaGLM4_sac <- betareg(soc_ac ~ eez_percent_prot + fish_reg_total, data = dat_select_sac) 
summary(BetaGLM4_sac) # best beta GLM

### Single variable
BetaGLM5_sac <- betareg(soc_ac ~ fish_reg_total, data = dat_select_sac)
summary(BetaGLM5_sac)

### Compare AICs
AIC(BetaGLM_sac, BetaGLM2_sac, BetaGLM3_sac, 
    BetaGLM4_sac, BetaGLM5_sac)
### BetaGLM5_sac (just fish_reg_total) has the lowest AIC

### Test performance of BetaGLM5_sac
pchisq(0.37664, BetaGLM5_sac$df.residual, lower.tail = FALSE)

### Best non-null beta model
best_beta_sac <- BetaGLM5_sac
```

### Compare best models (Socioeconomic adaptive capacity)
```{r}
best_beta_sac$pseudo.r.squared 
RsqGLM(gaussian_best_sac) 
RsqGLM(best_qb_sac) 
RsqGLM(LowestAIC_sac)

### Dsq
Dsquared(gaussian_best_sac)
Dsquared(best_qb_sac)
Dsquared(LowestAIC_sac)
```
Based on Pearson's the QB full model is best.


## Social-Ecological Vulnerability
```{r Social , echo=TRUE}
### df
dat_select_sev <- dat %>%
  na.omit() %>%
  dplyr::select(se_vul, eez_percent_prot, coral_percent_prot, fish_reg_total, wgi_score)

### Full model
results_sev <- glm(se_vul ~ ., data = dat_select_sev) # Model with all Xs included
Dsquared(results_sev)  # explained deviance with all Xs included = 0.1633741
plot(results_sev) #all Xs included
summary(results_sev) #all Xs 

#stepwise backward removal and addition of variables
stepAIC(results_sev, direction = "both")

#lowest AIC model
LowestAIC_sev <- glm(se_vul ~ fish_reg_total, data = dat_select_sev)
Dsquared(LowestAIC_sev)  # 0.1392345
plot(LowestAIC_sev) #all Xs included
summary(LowestAIC_sev) #all Xs included
```

### Gaussian error structure (Social-Ecological Vulnerability)
```{r}
### Gaussian null model
null_gaus_sev <- glm(se_vul ~ 1, data = dat_select_sev, family = gaussian(link = "identity"))

### Gaussian full model
gaussian_sev <- glm(se_vul ~ ., data = dat_select_sev, family = gaussian(link = "identity"))
Dsquared(gaussian_sev) ## 0.1633741
RsqGLM(gaussian_sev) 
vif(gaussian_sev) # all values below 1.5
plot(gaussian_sev) # all Xs included
summary(gaussian_sev) # all Xs included

# Comparing full model to the null
anova(null_gaus_sev, gaussian_sev, test = "Chisq")  # a decrease in deviance but a non-significant pvalue is a non-significant improvement

# model adequacy (values above 0.05 make an adequate model)
pchisq(0.085511 - 0.057259, gaussian_sev$df.null - gaussian_sev$df.residual, lower.tail = FALSE) ## 0.9999

# stepwise backward removal and addition of variables
stepAIC(gaussian_sev, direction = "both")

# Best non-null AIC model (fish_reg_total)
gaussian2_sev <- glm(se_vul ~ fish_reg_total, data = dat_select_sev, family = gaussian(link = "identity")) 
Dsquared(gaussian2_sev) # 0.1392345
RsqGLM(gaussian2_sev) # This is an approximation for an Rsqard

# Comparing new model to the null
anova(null_gaus_sev, gaussian2_sev, test = "Chisq")

# Comparing new model to the full
anova(gaussian_sev, gaussian2_sev, test = "Chisq")

### Assign Gaussian best model
gaussian_best_sev <- gaussian2_sev
summary(gaussian_best_sev)
cr.plots(gaussian_best_sev)
#model adequacy (values above 0.05 make an adequate model)
pchisq(0.058281, gaussian_best_sev$df.residual, lower.tail = FALSE)
```
Full Gaussian model is not better than null Gaussian. The lowest AIC Gaussian model is se_vul ~ fish_reg_total, but it does not offer a significant improvement over the null (it has lower residual deviance, but p = 0.059).  


### Quasibinomial error structure (Social-Ecological Vulnerability)
Can't run QB on this because it has values that are less than 0.
```{r}
```

### Beta error structure (Social-Ecological Vulnerability)
Can't run beta error on this because it has values that are less than 0.
```{r}
```

### Compare best models (Social-Ecological Vulnerability)
```{r}
RsqGLM(gaussian_best_sev) ### CoxSnell = 0.1392345, Tjur = NA, Pearson = 0.1392345
RsqGLM(LowestAIC_sev) ### CoxSnell = 0.1392345, Tjur = NA, Pearson = 0.1392345
```

Based on CoxSnell, best is Gaussian or normal best model (se_vul ~ fish_reg_total).